<html>
<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<link type="text/css" rel="stylesheet" href="./css/jquery.dropdown.css" />
</head>
<body>

	<div class="container">
		<div class="row">
			<div class="col-md-6">
				<header>
					<h1>Decision Tree</h1>
				</header>
			</div>
		</div>
	</div>
	<div class="container">
		<div class="row">
			
			<div id="data-output" class="col-md-6">
				
			</div>

			<div id="decision-tree" class="col-md-6">

			</div>

		</div>
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="./js/jquery.dropdown.min.js"></script>

	<script>
		var decisions = [];
		var count = 0;

		// get data
		$.getJSON( "./decisions.json")
		.done(function( data ) {
			var items = [];
			decisions = data;
			optionBuild();
		})
		.fail(function( jqxhr, textStatus, error ) {
			var err = textStatus + ", " + error;
			console.log( "Request Failed: " + err );
		});

		// sentence parts data
		var sentenceParts = [
		"I&#39;m interested in",
		"and want to know more about",
		"especially"
		];

		// function used onClick of options in the decision tree
		function optionBuild(id = null, btnText = "pick one"){
			// grab last count for #id's to show last option choosen
			var lastCount = count - 1;
			var lastButton = "#button-text-" + lastCount;
			$( lastButton ).empty();
			$( lastButton ).text( btnText );

			// pull options data
			var options = $.grep(decisions, function(v) {
				return v.parent == id;
			});

			// push into items the options under parent
			var items = [];
			$.each(options, function(idx, obj){
				if(obj.url === null){
					items.push( "<li onClick='optionBuild(" + obj.id + ", \"" + obj.text + "\" );'><a>" + obj.text + "</a></li>" );
				} else {
					items.push( "<li onClick='optionBuild(" + obj.id + ", \"" + obj.text + "\" );'><a href='" + obj.url + "'>" + obj.text + "</a></li>" );
				}
			});

			// force only showing 3 levels deep
			if(count < 3){

				// grab count for #id's
				var dataCount = "#data-" + count;

				// display sentence part
				$('<p>'+sentenceParts[count]+' <button id="button-text-'+count+'" data-jq-dropdown="'+dataCount+'" class="btn btn-primary">...</button></p>')
				.appendTo('#decision-tree');

				// display options well
				$('<div id="data-'+count+'" class="jq-dropdown"></div>')
				.appendTo('#decision-tree');

				// display options in the well
				$( "<ul/>", {
					"id": "list",
					"class": "jq-dropdown-menu",
					"onChange": "optionClicked();",
					html: items.join( "" )
				}).appendTo( dataCount );
			}
			count++;
		}

	</script>
</body>
</html>